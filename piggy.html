<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Habit Piggy - Piggy Bank</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>

  <nav class="nav">
    <button onclick="window.location.href='index.html'">ğŸ  Dashboard</button>
    <button onclick="window.location.href='calendar.html'">ğŸ“… Calendar</button>
    <button onclick="window.location.href='heatmap.html'">ğŸ”¥ Heatmap</button>
    <button onclick="window.location.href='reports.html'">ğŸ“Š Reports</button>
    <button onclick="window.location.href='logs.html'">ğŸ’» Logs</button>
    <button onclick="window.location.href='recipes.html'">ğŸ² Recipes</button>
    <button onclick="window.location.href='piggy.html'">ğŸ’° Piggy</button>
  </nav>

  <div class="container">

    <header class="header">
      <h1>ğŸ· Piggy Bank</h1>
    </header>

    <section class="card">
      <h1 style="font-size: 48px; text-align: center; margin: 20px 0;">â‚¹<span id="piggyBalance">0</span></h1>
      
      <button onclick="spendBalance()" class="primary-btn">Spend This Week</button>
      
      <button onclick="handleWithdraw()" class="primary-btn" style="margin-top: 10px; background: #f59e0b;">
        Withdraw Amount
      </button>
    </section>

    <section class="card">
      <h2>ğŸ’¸ Transaction History</h2>
      <div id="transactionList"></div>
    </section>

  </div>

  <script src="js/config.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/piggy.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      updatePiggyDisplay();
    });

    function updatePiggyDisplay() {
      const data = getData();
      document.getElementById("piggyBalance").innerText = data.balance || 0;
      
      const history = getTransactionHistory();
      const container = document.getElementById("transactionList");
      
      if (history.length === 0) {
        container.innerHTML = "<p>No transactions yet.</p>";
        return;
      }
      
      container.innerHTML = history.slice(0, 20).map(t => `
        <div class="mini-card">
          <strong>${t.date}</strong>
          ${t.earned ? `<p style="color: #22c55e;">+â‚¹${t.earned} earned</p>` : ''}
          ${t.penalty ? `<p style="color: #ef4444;">-â‚¹${t.penalty} penalty</p>` : ''}
          ${t.withdraw ? `<p style="color: #f59e0b;">-â‚¹${t.withdraw} withdrawn</p>` : ''}
          <p>Balance: â‚¹${t.balance}</p>
        </div>
      `).join("");
    }

    function spendBalance() {
      const result = withdrawAll();
      if (result.success) {
        alert(`Spent â‚¹${result.withdrawn}! Enjoy your reward ğŸ‰`);
        updatePiggyDisplay();
      }
    }

    function handleWithdraw() {
      const amount = prompt("Enter amount to withdraw:");
      if (!amount) return;
      
      const result = withdrawAmount(parseFloat(amount));
      if (result.success) {
        alert(`Withdrew â‚¹${amount} successfully!`);
        updatePiggyDisplay();
      } else {
        alert(result.message);
      }
    }
  </script>
</body>
</html>
